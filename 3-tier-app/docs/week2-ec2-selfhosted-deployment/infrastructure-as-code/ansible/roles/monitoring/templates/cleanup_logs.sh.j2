#!/bin/bash
# Log cleanup script for {{ app.name }}
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

RETENTION_DAYS={{ backup.retention_days }}
LOG_DIR="{{ app.logs_dir }}"

echo "$(date): Starting log cleanup (retention: ${RETENTION_DAYS} days)"

# Clean application logs
find "$LOG_DIR" -name "*.log" -mtime +$RETENTION_DAYS -delete
find "$LOG_DIR" -name "*.log.*" -mtime +$RETENTION_DAYS -delete

# Clean compressed logs
find "$LOG_DIR" -name "*.gz" -mtime +$RETENTION_DAYS -delete

# Clean PM2 logs older than retention period
su {{ app.user }} -c "pm2 flush" >/dev/null 2>&1

echo "$(date): Log cleanup completed"
